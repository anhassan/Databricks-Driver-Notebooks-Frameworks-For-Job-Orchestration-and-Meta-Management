# -*- coding: utf-8 -*-
"""curated_semantic_ingestion.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1JenGqWPpjOgCt95DlJGN21UKKjsf1Ah_
"""

# Commented out IPython magic to ensure Python compatibility.
# %sql

INSERT OVERWRITE SCHEMA_SEMANTIC.HSP
--SELECT DISTINCT
SELECT
  HA.HSP_ACCOUNT_ID
, HA.HSP_ACCOUNT_NAME AS HSP_ACCOUNT_NM
, HA.ACCT_BASECLS_HA_C
, ZC_BASECLS.NAME AS ACCT_BASECLS_NM
, HA.LOC_ID
, HA.SERV_AREA_ID
, HA.PAT_ID
, HA.PRIM_ENC_CSN_ID
, HA.ACCT_BILLED_DATE
, HA.ACCT_CLASS_HA_C
, HA.ACCT_CLOSE_DATE
, HA.ACCT_FIN_CLASS_C
, FC.FINANCIAL_CLASS_NAME AS FINANCIAL_CLASS_NM
, HA.ADM_DATE_TIME
, HA.ADM_PROV_ID
, HA.ATTENDING_PROV_ID
, HA.CODE_BLUE_YNU
, HA.COMBINE_ACCT_ID
, HA.COVERAGE_ID
, HA.DISCH_DATE_TIME
, HA.DISCH_DEPT_ID
, DEP.DEPARTMENT_NAME AS DISCH_DEPT_NM
, HA.DISCH_LOC_ID
, LOC.LOC_NAME AS DISCH_LOC_NM
, HA.DISCH_DESTIN_HA_C
, ZC_DEST.NAME AS DISCH_DEST
, HA.PRIMARY_PAYOR_ID
, EPM.PAYOR_NAME AS PRIMARY_PAYOR_NM
, HA.PRIMARY_PLAN_ID
, EPP.BENEFIT_PLAN_NAME AS PRIMARY_PLAN_NM
, EPP2.PROD_TYPE_C 
, ZC_PT.NAME AS PRODUCT_TYPE
, HA.BILL_DRG_AMLOS
, HA.BILL_DRG_GMLOS
, HA.FINAL_DRG_ID
, FINAL_DRG.DRG_NAME AS FINAL_DRG_NM
, HA.TOT_CHGS
, HA.CM_LOG_OWNER_ID
, HA3.IP_ADMIT_DATE_TIME
, HA4.BILLING_LENGTH_OF_STAY
, PAT.PAT_MRN_ID
, PAT.DEATH_DATE
, PAT.BIRTH_DATE
, PAT.PAT_STATUS_C
, ZC_PC.NAME AS PAT_STATUS_NM
, PAT.SEX_C
, ZC_SEX.NAME AS GENDER
, PAT.CUR_PCP_PROV_ID
,HA.ACCT_BILLSTS_HA_C
,ZC_BILLSTS.NAME AS BILLSTS_NM
FROM SCHEMA_CURATED.HSP_ACCOUNT HA
INNER JOIN SCHEMA_CURATED.HSP_ACCOUNT_3 HA3 ON HA.HSP_ACCOUNT_ID = HA3.HSP_ACCOUNT_ID
INNER JOIN SCHEMA_CURATED.HSP_ACCOUNT_4 HA4 ON HA.HSP_ACCOUNT_ID = HA4.HSP_ACCOUNT_ID
LEFT OUTER JOIN SCHEMA_CURATED.PATIENT PAT ON HA.PAT_ID = PAT.PAT_ID AND HA.CM_LOG_OWNER_ID = PAT.CM_LOG_OWNER_ID 
LEFT OUTER JOIN SCHEMA_CURATED.CLARITY_FC FC ON HA.ACCT_FIN_CLASS_C = FC.FINANCIAL_CLASS
LEFT OUTER JOIN SCHEMA_CURATED.CLARITY_EPM EPM ON HA.PRIMARY_PAYOR_ID = EPM.PAYOR_ID         AND HA.CM_LOG_OWNER_ID = EPM.CM_LOG_OWNER_ID    
LEFT OUTER JOIN SCHEMA_CURATED.CLARITY_EPP EPP                ON HA.PRIMARY_PLAN_ID = EPP.BENEFIT_PLAN_ID   AND HA.CM_LOG_OWNER_ID = EPP.CM_LOG_OWNER_ID   
LEFT OUTER JOIN SCHEMA_CURATED.CLARITY_EPP_2 EPP2             ON EPP.BENEFIT_PLAN_ID = EPP2.BENEFIT_PLAN_ID AND EPP.CM_LOG_OWNER_ID = EPP.CM_LOG_OWNER_ID
LEFT OUTER JOIN SCHEMA_CURATED.ZC_PROD_TYPE ZC_PT             ON EPP2.PROD_TYPE_C = ZC_PT.PROD_TYPE_C 
LEFT OUTER JOIN SCHEMA_CURATED.ZC_SEX ZC_SEX ON PAT.SEX_C = ZC_SEX.RCPT_MEM_SEX_C
LEFT OUTER JOIN SCHEMA_CURATED.ZC_DISCH_DEST ZC_DEST          ON HA.DISCH_DESTIN_HA_C = ZC_DEST.DISCH_DEST_C
LEFT OUTER JOIN SCHEMA_CURATED.ZC_ACCT_BASECLS_HA ZC_BASECLS  ON HA.ACCT_BASECLS_HA_C = ZC_BASECLS.ACCT_BASECLS_HA_C
LEFT OUTER JOIN SCHEMA_CURATED.ZC_PAT_CLASS ZC_PC             ON PAT.PAT_STATUS_C = ZC_PC.ADT_PAT_CLASS_C
LEFT OUTER JOIN SCHEMA_CURATED.CLARITY_DEP DEP                ON HA.DISCH_DEPT_ID = DEP.DEPARTMENT_ID
LEFT OUTER JOIN SCHEMA_CURATED.CLARITY_LOC LOC                ON DEP.REV_LOC_ID = LOC.LOC_ID
LEFT OUTER JOIN SCHEMA_CURATED.ZC_ACCT_BILLSTS_HA ZC_BILLSTS ON HA.ACCT_BILLSTS_HA_C = ZC_BILLSTS.ACCT_BILLSTS_HA_C
LEFT OUTER JOIN SCHEMA_CURATED.CLARITY_DRG FINAL_DRG         ON HA.FINAL_DRG_ID=FINAL_DRG.DRG_ID
WHERE HA.ADM_DATE_TIME >= '2021-07-01'
);